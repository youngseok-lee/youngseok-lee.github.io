name: SSH via Tailscale

on:
  workflow_dispatch:
    inputs:
      command:
        description: 'Command to run on the server'
        required: false
        default: 'uname -a && cat /etc/os-release && hostnamectl && df -h && free -h'

jobs:
  ssh-server:
    runs-on: ubuntu-latest
    steps:
      - name: Setup Tailscale
        uses: tailscale/github-action@v3
        with:
          oauth-client-id: ${{ secrets.TS_OAUTH_CLIENT_ID }}
          oauth-secret: ${{ secrets.TS_OAUTH_SECRET }}
          tags: tag:ci

      - name: SSH to server and check OS
        run: |
          # Wait for Tailscale to connect
          sleep 5
          tailscale status

          # SSH to server (add your server's Tailscale IP or hostname)
          ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null \
            root@100.121.28.24 "${{ github.event.inputs.command }}"
